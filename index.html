<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <meta name="apple-mobile-web-app-capable" content="yes">
    <title>Panto-Meter Pro</title>
    
    <style>
        body {
            margin: 0;
            background: #000;
            overflow: hidden;
            font-family: 'Segoe UI', sans-serif;
            color: white;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
            height: 100vh;
        }

        video {
            position: fixed; top: 0; left: 0;
            width: 100%; height: 100%;
            object-fit: cover; z-index: 1;
        }

        .overlay {
            position: absolute; top: 0; left: 0;
            width: 100%; height: 100%; z-index: 2;
            pointer-events: none;
            display: flex;
            flex-direction: column;
            align-items: center;
            justify-content: center;
        }

        /* --- YENÄ°: DÄ°KEY KILAVUZ Ã‡Ä°ZGÄ° --- */
        .guide-line {
            width: 4px; /* Ä°nce */
            height: 80%; /* Uzun (Dikey) */
            background-color: #0DFF72;
            box-shadow: 0 0 10px #0DFF72;
            position: absolute;
            top: 10%; left: 50%; /* Tam ortada */
            transform: translateX(-50%);
            border-radius: 2px;
        }

        /* Merkez Nokta */
        .center-cross {
            width: 20px; height: 4px;
            background: red;
            position: absolute;
            top: 50%; left: 50%;
            transform: translate(-50%, -50%);
        }

        /* AÃ§Ä± GÃ¶stergesi */
        .angle-display {
            position: absolute;
            right: 40px; /* SaÄŸ tarafta dursun */
            top: 50%; transform: translateY(-50%);
            background: rgba(0, 0, 0, 0.6);
            padding: 20px;
            border-radius: 15px;
            border: 2px solid #0DFF72;
            text-align: center;
            backdrop-filter: blur(5px);
        }
        .angle-val { font-size: 50px; font-weight: bold; color: #fff; }
        .angle-label { font-size: 12px; color: #ccc; margin-top: 5px; font-weight: bold; }

        /* Butonlar */
        .controls {
            position: absolute; bottom: 30px; right: 30px;
            z-index: 10; display: flex; gap: 20px; pointer-events: auto;
        }

        .btn {
            padding: 15px 30px; border-radius: 12px; border: none;
            font-size: 16px; font-weight: bold; cursor: pointer;
            box-shadow: 0 4px 10px rgba(0,0,0,0.5);
            transition: transform 0.1s;
        }
        .btn:active { transform: scale(0.95); }
        .btn-start { background: #3877FF; color: white; }
        .btn-freeze { background: #FF0D72; color: white; display: none; }

        /* UyarÄ± EkranlarÄ± */
        #orientation-warning, #permission-screen {
            position: fixed; top:0; left:0; width:100%; height:100%;
            background: #111; z-index: 99;
            display: flex; flex-direction: column;
            align-items: center; justify-content: center;
            text-align: center; padding: 20px;
        }
        
        .warn-icon { font-size: 60px; margin-bottom: 20px; }
        .warn-text { font-size: 20px; line-height: 1.5; color: #eee; }

    </style>
</head>
<body>

    <video id="video" autoplay playsinline muted></video>

    <div class="overlay">
        <div class="angle-display">
            <div class="angle-val" id="angle-text">0Â°</div>
            <div class="angle-label">AÃ‡I</div>
        </div>

        <div class="guide-line"></div>
        <div class="center-cross"></div>
    </div>

    <div class="controls">
        <button class="btn btn-freeze" id="btn-freeze" onclick="toggleFreeze()">DONDUR</button>
    </div>

    <div id="orientation-warning" style="display:flex;">
        <div class="warn-icon">ğŸ”„</div>
        <div class="warn-text">
            LÃ¼tfen Ã¶lÃ§Ã¼m iÃ§in telefonu<br>
            <b style="color:#0DFF72">YAN Ã‡EVÄ°RÄ°N</b>
        </div>
    </div>

    <div id="permission-screen" style="display:none;">
        <div class="warn-icon">ğŸ“</div>
        <div class="warn-text" style="margin-bottom:30px">
            Pantoskopik Ã–lÃ§er HazÄ±r.<br>
            SensÃ¶rleri aktif etmek iÃ§in butona bas.
        </div>
        <button class="btn btn-start" onclick="requestPermissions()">BAÅLAT & Ä°ZÄ°N VER</button>
        <div style="font-size:12px; color:#666; margin-top:20px; max-width:300px;">
            Not: Apple gizlilik kurallarÄ± gereÄŸi bu izni her seferinde vermeniz gerekmektedir.
        </div>
    </div>

    <script>
        const video = document.getElementById('video');
        const angleText = document.getElementById('angle-text');
        const btnFreeze = document.getElementById('btn-freeze');
        
        const screenOrient = document.getElementById('orientation-warning');
        const screenPerm = document.getElementById('permission-screen');

        let currentAngle = 0;
        let isFrozen = false; 

        // --- YÃ–N KONTROLÃœ (Bug Fix) ---
        function checkOrientation() {
            // Ekran geniÅŸliÄŸi > yÃ¼ksekliÄŸi ise YATAYDIR
            if (window.innerWidth > window.innerHeight) {
                screenOrient.style.display = 'none';
                // EÄŸer izin alÄ±nmadÄ±ysa Ä°zin EkranÄ±nÄ± gÃ¶ster
                if (!window.permissionGranted) {
                    screenPerm.style.display = 'flex';
                }
            } else {
                // Dikeyse uyar
                screenOrient.style.display = 'flex';
                screenPerm.style.display = 'none';
            }
        }

        // Resize ve OrientationChange eventlerini dinle (HÄ±zlÄ± tepki iÃ§in)
        window.addEventListener('resize', checkOrientation);
        window.addEventListener('orientationchange', () => {
            setTimeout(checkOrientation, 200); // iOS bazen gecikir
        });
        
        // BaÅŸlangÄ±Ã§ kontrolÃ¼
        checkOrientation();


        // --- Ä°ZÄ°N VE BAÅLATMA ---
        async function requestPermissions() {
            // 1. SensÃ¶r Ä°zni
            if (typeof DeviceOrientationEvent !== 'undefined' && typeof DeviceOrientationEvent.requestPermission === 'function') {
                try {
                    const response = await DeviceOrientationEvent.requestPermission();
                    if (response === 'granted') {
                        window.permissionGranted = true;
                        window.addEventListener('deviceorientation', handleOrientation);
                        screenPerm.style.display = 'none';
                        btnFreeze.style.display = 'block';
                        startCamera();
                    } else {
                        alert("Ä°zin verilmedi.");
                    }
                } catch (e) {
                    alert(e);
                }
            } else {
                // Android
                window.permissionGranted = true;
                window.addEventListener('deviceorientation', handleOrientation);
                screenPerm.style.display = 'none';
                btnFreeze.style.display = 'block';
                startCamera();
            }
        }

        async function startCamera() {
            try {
                const stream = await navigator.mediaDevices.getUserMedia({ 
                    video: { facingMode: 'environment' } 
                });
                video.srcObject = stream;
            } catch (err) {
                console.log("Kamera hatasÄ±: " + err);
            }
        }

        // --- AÃ‡I HESAPLAMA (YENÄ° MANTIK: DÄ°KEY Ã‡Ä°ZGÄ°) ---
        function handleOrientation(event) {
            if (isFrozen) return;

            // Telefon YATAY (Landscape) tutuluyor.
            // Bu konumda telefonu direksiyon gibi (saÄŸa/sola) Ã§evirmek 'beta' deÄŸerini deÄŸiÅŸtirir.
            // Beta: -180 ile 180 arasÄ±ndadÄ±r.
            // Telefon tam dikken (yerÃ§ekimine paralel) beta ~0 olmalÄ± (veya cihaza gÃ¶re deÄŸiÅŸebilir).
            
            let tilt = event.beta; 
            
            // iOS ve Android farkÄ± iÃ§in ufak bir kontrol gerekebilir ama
            // Genelde Beta ekseni yatay tutuÅŸta roll (yuvarlanma) eksenidir.

            // Ä°stenilen MantÄ±k: Sola (-) SaÄŸa (+)
            // DeÄŸer yuvarlama
            let angle = Math.round(tilt);

            // AÃ§Ä± Ã§ok sapÄ±tÄ±rsa (telefonu masaya koyarsan gamma devreye girer) filtrele
            if (Math.abs(angle) > 90) {
                // Bazen sensÃ¶r 180'den dÃ¶ner, dÃ¼zeltme:
                angle = 0; 
            }

            currentAngle = angle;
            
            // ArtÄ± iÅŸareti ekle
            let displayTxt = currentAngle + "Â°";
            if(currentAngle > 0) displayTxt = "+" + displayTxt;
            
            angleText.innerText = displayTxt;

            // Renk: 0'a yakÄ±nsa yeÅŸil, uzaklaÅŸtÄ±kÃ§a beyaz
            if(Math.abs(currentAngle) < 2) angleText.style.color = "#0DFF72";
            else angleText.style.color = "white";
        }

        // --- DONDURMA ---
        function toggleFreeze() {
            isFrozen = !isFrozen;
            if (isFrozen) {
                btnFreeze.innerText = "DEVAM ET";
                btnFreeze.style.backgroundColor = "#444";
                video.pause();
            } else {
                btnFreeze.innerText = "DONDUR";
                btnFreeze.style.backgroundColor = "#FF0D72";
                video.play();
            }
        }
    </script>
</body>
</html>
